@model IEnumerable<QuanLyTruongMauGiao.Models.THUCDONNGAY>
@using QuanLyTruongMauGiao.Models

@{
    ViewBag.Title = "DangKiBuaAn";
    Layout = "~/Views/Shared/LayoutPH.cshtml";
}

<h2>Đăng kí bữa ăn</h2>
<br />

@using (Html.BeginForm("dangkibuaan", "chucnangphuhuynh", FormMethod.Post, new { enctype = "multipart/form-data" }))
{
    <div class="form-control col-10" style="width:70%" id="registerMealContainer">
        <dl class="dl-horizontal">
            <table class="table" id="tblRegisterMeal">
                <tr>
                    <p>
                        <input type="date" name="startdate" /> to <input type="date" name="enddate" />
                        <input type="submit" value="Search" />
                    </p>
                </tr>
                <tr>
                    <th>
                        Ngày
                    </th>
                    <th>
                        Bữa sáng
                    </th>
                    <th>
                        Bữa trưa
                    </th>
                    <th>
                        Bữa xế
                    </th>
                    <th>
                        Chọn
                    </th>
                </tr>

                @foreach (var item in Model)
                {
                    <tr class="tbl-row">
                        <td class="date-col">
                            @item.Ngay.ToString("dd/MM/yyyy")
                        </td>
                        <td>
                            @item.BuaSang
                        </td>
                        <td>
                            @item.BuaTrua
                        </td>
                        <td>
                            @item.BuaXe
                        </td>
                        <td class="select-col">
                            <input type="checkbox" name="choice" />
                        </td>
                    </tr>
                }
            </table>
        </dl>
    </div>
    <br />
    <div class="form-group row">
        <div class="col-sm-10 ml-sm-auto">
            <button class="btn btn-info" type="button" onclick="pressSubmitBtn(this)" style="margin:0 30px 0 50px">Đăng kí</button><button class="btn btn-info" style="background-color:grey" type="reset">Hủy</button>
        </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        function pressSubmitBtn($btn) {
            let data = [];
            let trs = document.querySelectorAll("#tblRegisterMeal tr.tbl-row");
            if (trs) {
                trs.forEach((tr) => {
                    let date = tr.querySelector("td.date-col").innerText;
                    let select = tr.querySelector("td.select-col input[name=choice]").checked;
                    if (select) {
                        data.push({
                            date: date,
                            select: select
                        });
                    }
                })
            }

            console.log(data);

            var url = "@Url.Action("dangkibuaan", "chucnangphuhuynh")";

            $.ajax({
                type: "POST",
                data: JSON.stringify(data),
                url: url,
                contentType: "application/json"
            }).done(function (res) {
                console.log("submit successful!");
            });

        }
    </script>
}


